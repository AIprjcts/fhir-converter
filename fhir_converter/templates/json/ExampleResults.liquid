{
  "resourceType": "Bundle",
  "type": "collection",
  "entry": [
    {% for result in msg.Results %}
    {% if result.TypeName == "Order" %}
    {
      "resource": {
        "resourceType": "ServiceRequest",
        "id": "{{ result.Id.Value }}",
        "status": "active",
        "intent": "order",
        "code": {
          "text": "{{ result.Name }}"
        },
        "subject": {
          "reference": "Patient/{{ result.Results[0].ProviderId.Value }}"
        },
        "authoredOn": "{% if result.OrderDate %}{{ result.OrderDate | format_date_time }}{% endif %}",
        "occurrenceDateTime": "{% if result.CollectedDate %}{{ result.CollectedDate | format_date_time }}{% endif %}",
        "orderDetail": [
          {
            "timing": {
              "dateTime": "{% if result.OrderDatePart.DateTime %}{{ result.OrderDatePart.DateTime | format_date_time }}{% endif %}",
              "date": "{% if result.OrderDatePart.Date %}{{ result.OrderDatePart.Date | format_date_time }}{% endif %}"
            }
          }
        ],
        "result": [
          {% for observation in result.Results %}
          {
            "resource": {
              "resourceType": "Observation",
              "id": "{{ observation.Id.Value }}",
              "code": {
                "text": "{{ observation.Name }}"
              },
              "valueQuantity": {
                "value": {% if observation.Measurement.HasNumericValue %}{{ observation.Measurement.NumericValue }}{% else %}null{% endif %},
                "unit": "{% if observation.Measurement.Units %}{{ observation.Measurement.Units }}{% else %}see details{% endif %}",
                "system": "{{ observation.Measurement.MeasurementSystem }}",
                "code": "{{ observation.Measurement.Value }}"
              },
              "interpretation": [
                {% if observation.IsAbnormal %}
                {
                  "coding": [
                    {
                      "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                      "code": "A",
                      "display": "Abnormal"
                    }
                  ]
                }
                {% endif %}
              ],
              "referenceRange": [
                {
                  "text": "{{ observation.NormalRange }}"
                }
              ]
            }
          }{% unless forloop.last %},{% endunless %}
          {% endfor %}
        ]
      }
    }{% unless forloop.last %},{% endunless %}
    {% endif %}
    {% endfor %}
  ]
}